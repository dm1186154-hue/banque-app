<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js"></script>

<script>
  // ðŸ”‘ Configuration Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAwGbQuv9EoIvBm7WC0OLTQ41cgleXd804",
    authDomain: "banque-app-66bf9.firebaseapp.com",
    projectId: "banque-app-66bf9",
    storageBucket: "banque-app-66bf9.appspot.com",
    messagingSenderId: "61613833199",
    appId: "1:61613833199:web:5d4c81a1d8ecb6f7f3d6e0"
  };

  // âš™ï¸ Initialisation Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ðŸ§ VÃ©rifie la connexion utilisateur
  auth.onAuthStateChanged(user => {
    if (!user) {
      alert("Veuillez vous connecter pour accÃ©der au tableau de bord !");
      window.location.href = "login.html";
    } else {
      // ðŸ”„ Charger les infos utilisateur depuis Firestore
      const userDoc = db.collection("users").doc(user.uid);
      userDoc.get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
          document.getElementById("balance").textContent = data.balance + " FCFA";
        } else {
          // ðŸ”° CrÃ©e un nouveau compte avec 0 FCFA
          userDoc.set({
            email: user.email,
            balance: 0,
            transactions: []
          });
          document.getElementById("balance").textContent = "0 FCFA";
        }
      });
    }
  });

  // ðŸ’¸ DÃ©pÃ´t
  function makeDeposit() {
    const amount = prompt("Montant Ã  dÃ©poser (FCFA) :");
    if (amount && !isNaN(amount)) {
      const user = auth.currentUser;
      const userDoc = db.collection("users").doc(user.uid);
      userDoc.update({
        balance: firebase.firestore.FieldValue.increment(Number(amount))
      }).then(() => {
        alert("DÃ©pÃ´t de " + amount + " FCFA rÃ©ussi âœ…");
        location.reload();
      });
    }
  }

  // ðŸ’¸ Transfert
  function makeTransfer() {
    const recipientEmail = prompt("Email du destinataire :");
    const amount = parseFloat(prompt("Montant Ã  transfÃ©rer (FCFA) :"));
    if (recipientEmail && amount && amount > 0) {
      const sender = auth.currentUser;
      const senderDoc = db.collection("users").doc(sender.uid);

      db.runTransaction(async (t) => {
        const senderSnap = await t.get(senderDoc);
        const senderBalance = senderSnap.data().balance;

        if (senderBalance < amount) throw "Solde insuffisant âš ï¸";

        const recipientSnap = await db.collection("users")
          .where("email", "==", recipientEmail)
          .get();

        if (recipientSnap.empty) throw "Destinataire introuvable âŒ";

        const recipientDoc = recipientSnap.docs[0].ref;

        // ðŸ” Effectue le transfert
        t.update(senderDoc, { balance: senderBalance - amount });
        t.update(recipientDoc, {
          balance: firebase.firestore.FieldValue.increment(amount)
        });
      })
      .then(() => {
        alert("Transfert de " + amount + " FCFA effectuÃ© avec succÃ¨s âœ…");
        location.reload();
      })
      .catch(error => alert("Erreur : " + error));
    }
  }

  // ðŸ§ Retrait (simulation)
  function makeWithdraw() {
    const amount = prompt("Montant Ã  retirer (FCFA) :");
    if (amount && !isNaN(amount)) {
      const user = auth.currentUser;
      const userDoc = db.collection("users").doc(user.uid);
      userDoc.update({
        balance: firebase.firestore.FieldValue.increment(-Number(amount))
      }).then(() => {
        alert("Retrait de " + amount + " FCFA effectuÃ© âœ…");
        location.reload();
      });
    }
  }

  // ðŸšª DÃ©connexion
  function logout() {
    auth.signOut().then(() => {
      alert("DÃ©connexion rÃ©ussie âœ…");
      window.location.href = "login.html";
    });
  }
          </script>
