import { auth } from "./firebase.js";
import {
  RecaptchaVerifier,
  signInWithPhoneNumber
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

// â–¶ï¸ Activer invisible reCAPTCHA
window.recaptchaVerifier = new RecaptchaVerifier(
  "recaptcha-container",
  { size: "invisible" },
  auth
);

// â–¶ï¸ Envoi du SMS
document.getElementById("btn-inscription").addEventListener("click", () => {
  const phone = document.getElementById("phone").value;
  const nom = document.getElementById("nom").value;

  if (nom.trim() === "" || phone.trim() === "") {
    alert("Veuillez remplir tous les champs.");
    return;
  }

  signInWithPhoneNumber(auth, phone, window.recaptchaVerifier)
    .then((confirmationResult) => {
      window.confirmationResult = confirmationResult;

      alert("ğŸ“© Code envoyÃ© sur votre numÃ©ro âœ”ï¸");
      document.getElementById("sms-section").style.display = "block";
    })
    .catch((error) => {
      alert("Erreur : " + error.message);
    });
});

// â–¶ï¸ VÃ©rification du code SMS
document.getElementById("btn-valider").addEventListener("click", () => {
  const code = document.getElementById("code").value;

  confirmationResult
    .confirm(code)
    .then((result) => {
      alert("Compte crÃ©Ã© avec succÃ¨s âœ”ï¸");
      window.location.href = "dashboard.html"; // redirection
    })
    .catch((error) => {
      alert("Code incorrect âŒ");
    });
});
