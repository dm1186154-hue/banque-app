import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAwGbQuv9EoIvBm7WC0OLTQ41cgleXd804",
  authDomain: "banque-app-66bf9.firebaseapp.com",
  projectId: "banque-app-66bf9",
  storageBucket: "banque-app-66bf9.firebasestorage.app",
  messagingSenderId: "833823730245",
  appId: "1:833823730245:web:64dd77db2f273d24f9912c"
};

// ğŸ”¥ Initialisation Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
auth.languageCode = 'fr';

// ğŸ” reCAPTCHA
window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
  size: 'normal',
  callback: (response) => {
    document.getElementById("send-code").disabled = false;
  },
});

// ğŸ“² Envoyer le code
document.getElementById("send-code").addEventListener("click", () => {
  const phoneNumber = document.getElementById("phone").value;
  const appVerifier = window.recaptchaVerifier;

  signInWithPhoneNumber(auth, phoneNumber, appVerifier)
    .then((confirmationResult) => {
      window.confirmationResult = confirmationResult;
      alert("ğŸ“© Code envoyÃ© sur ton tÃ©lÃ©phone !");
      document.getElementById("verify-section").style.display = "block";
    })
    .catch((error) => {
      alert("âŒ Erreur : " + error.message);
    });
});

// âœ… VÃ©rifier le code
document.getElementById("verify-code").addEventListener("click", () => {
  const code = document.getElementById("verification-code").value;
  const nom = document.getElementById("nom").value;

  confirmationResult.confirm(code)
    .then((result) => {
      const user = result.user;
      localStorage.setItem("nomUtilisateur", nom);
      alert("âœ… Bienvenue " + nom + " !");
      window.location.href = "tableau_de_bord.html";
    })
    .catch((error) => {
      alert("âŒ Code invalide ou expirÃ© !");
    });
});
