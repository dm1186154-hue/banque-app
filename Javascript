import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const soldeEl = document.getElementById("solde");
const logoutBtn = document.getElementById("logout");
const transfertBtn = document.getElementById("btn-transfert");
const historiqueBtn = document.getElementById("btn-historique");
const msg = document.getElementById("message");
const userName = document.getElementById("display-name");

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "connexion.html";
  } else {
    const docRef = doc(db, "comptes", user.uid);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();
      soldeEl.textContent = `${data.solde.toLocaleString()} FCFA`;
      userName.textContent = `${data.prenom || "Utilisateur"} ${data.nom || ""}`;
    } else {
      soldeEl.textContent = "0 FCFA";
      userName.textContent = "Nouvel utilisateur";
    }
  }
});

// DÃ©connexion
logoutBtn.addEventListener("click", () => {
  signOut(auth)
    .then(() => {
      window.location.href = "connexion.html";
    })
    .catch((error) => {
      msg.textContent = "Erreur lors de la dÃ©connexion : " + error.message;
    });
});

// Bouton transfert
transfertBtn.addEventListener("click", () => {
  msg.textContent = "ğŸš€ Fonction de transfert en prÃ©paration...";
});

// Bouton historique
historiqueBtn.addEventListener("click", () => {
  msg.textContent = "ğŸ“œ Historique des transactions bientÃ´t disponible...";
});
